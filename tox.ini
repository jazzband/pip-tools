[tox]
envlist =
    # NOTE: keep this in sync with the env list in .github/workflows/ci.yml.
    py{27,35,36,37,38,39,py,py3}-pip{20.1,20.2,20.3,previous,latest,master}-coverage
    checkqa
    readme
skip_missing_interpreters = True

[testenv]
extras =
    testing
    coverage: coverage
deps =
    pipprevious: pip==20.2.*
    # TODO: change to `pip` after pip-20.3 being released
    piplatest: -e git+https://github.com/pypa/pip.git@master#egg=pip
    pipmaster: -e git+https://github.com/pypa/pip.git@master#egg=pip
    pip20.1: pip==20.1.*
    pip20.2: pip==20.2.*
    # TODO: change to `pip==20.3.*` after pip-20.3 being released
    pip20.3: -e git+https://github.com/pypa/pip.git@master#egg=pip
setenv =
    pipprevious: PIP=previous
    piplatest: PIP=latest
    pipmaster: PIP=master
    pip20.1: PIP==20.1
    pip20.2: PIP==20.2
    pip20.3: PIP==20.3

    coverage: PYTEST_ADDOPTS=--strict --doctest-modules --cov --cov-report=term-missing --cov-report=xml {env:PYTEST_ADDOPTS:}
commands_pre =
    piplatest: python -m pip install -U pip
    pip --version
commands = pytest {posargs}
passenv = CI GITHUB_ACTIONS
pip_pre=True

[testenv:checkqa]
basepython = python3
skip_install = True
deps = pre-commit
commands_pre =
commands = pre-commit run --all-files --show-diff-on-failure

[testenv:readme]
deps = twine
commands_pre =
commands = twine check {distdir}/*
